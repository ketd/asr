# é¡¹ç›®æ¶æ„æ–‡æ¡£

## è®¾è®¡ç†å¿µ

æœ¬é¡¹ç›®å‚è€ƒäº† [Obsidian Sample Plugin](https://github.com/obsidianmd/obsidian-sample-plugin) çš„æœ€ä½³å®è·µï¼Œæ˜¯ä¸€ä¸ªç»è¿‡å¤šå¹´å®è·µéªŒè¯çš„æ¨¡æ¿æ¶æ„ã€‚

### æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **çº¦å®šä¼˜äºé…ç½®** - ç»Ÿä¸€çš„æ–‡ä»¶ç»“æ„å’Œå‘½åè§„èŒƒ
2. **è‡ªåŠ¨åŒ–ä¼˜å…ˆ** - æœ€å°åŒ–æ‰‹åŠ¨æ“ä½œï¼Œæœ€å¤§åŒ–è‡ªåŠ¨åŒ–
3. **æ ‡å‡†åŒ–** - éµå¾ª Python ç”Ÿæ€çš„æœ€ä½³å®è·µï¼ˆPEP 621, PEP 517ï¼‰
4. **å¼€å‘è€…å‹å¥½** - æ¸…æ™°çš„æ–‡æ¡£å’Œä¸°å¯Œçš„ç¤ºä¾‹

## æŠ€æœ¯é€‰å‹

### åŒ…ç®¡ç†: uv

é€‰æ‹© [uv](https://github.com/astral-sh/uv) è€Œéä¼ ç»Ÿçš„ pip + virtualenvï¼š

**ä¼˜åŠ¿ï¼š**
- âš¡ **é€Ÿåº¦å¿«**: æ¯” pip å¿« 10-100 å€
- ğŸ”’ **å¯é æ€§**: æ›´å¥½çš„ä¾èµ–è§£æ
- ğŸ“¦ **ç°ä»£åŒ–**: æ”¯æŒ PEP 621 æ ‡å‡†
- ğŸ¯ **ä¸€è‡´æ€§**: è‡ªåŠ¨ç®¡ç†è™šæ‹Ÿç¯å¢ƒ

### æ„å»ºç³»ç»Ÿ: Hatchling

ä½¿ç”¨ [Hatchling](https://github.com/pypa/hatch) ä½œä¸ºæ„å»ºåç«¯ï¼š

**ä¼˜åŠ¿ï¼š**
- âœ… ç¬¦åˆ PEP 517/518 æ ‡å‡†
- ğŸ“ çµæ´»çš„æ–‡ä»¶åŒ…å«è§„åˆ™
- ğŸš€ å¿«é€Ÿæ„å»º
- ğŸ”§ å¯æ‰©å±•çš„æ’ä»¶ç³»ç»Ÿ

### æµ‹è¯•æ¡†æ¶: Pytest

é€‰æ‹© pytest è€Œé unittestï¼š

**ä¼˜åŠ¿ï¼š**
- ğŸ’¡ ç®€æ´çš„è¯­æ³•
- ğŸ” è¯¦ç»†çš„é”™è¯¯æŠ¥å‘Š
- ğŸ§© ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€
- âš¡ å¿«é€Ÿæ‰§è¡Œ

## é¡¹ç›®ç»“æ„è¯´æ˜

```
prefab-template/
â”‚
â”œâ”€â”€ .github/                      # GitHub é…ç½®
â”‚   â”œâ”€â”€ workflows/
â”‚   â”‚   â””â”€â”€ build-and-release.yml # CI/CD ä¸»æµç¨‹
â”‚   â”œâ”€â”€ ISSUE_TEMPLATE/           # Issue æ¨¡æ¿
â”‚   â””â”€â”€ PULL_REQUEST_TEMPLATE.md  # PR æ¨¡æ¿
â”‚
â”œâ”€â”€ src/                          # æºä»£ç ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”œâ”€â”€ __init__.py              # æ¨¡å—å¯¼å‡º
â”‚   â”œâ”€â”€ main.py                  # ä¸»å…¥å£ï¼ˆå¿…é¡»ï¼‰
â”‚   â””â”€â”€ utils/                   # å·¥å…·æ¨¡å—ç¤ºä¾‹
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ math_utils.py        # æ•°å­¦å·¥å…·
â”‚
â”œâ”€â”€ tests/                        # æµ‹è¯•ä»£ç 
â”‚   â”œâ”€â”€ test_main.py             # ä¸»å‡½æ•°æµ‹è¯•
â”‚   â””â”€â”€ test_utils.py            # å·¥å…·å‡½æ•°æµ‹è¯•
â”‚
â”œâ”€â”€ scripts/                      # è¾…åŠ©è„šæœ¬
â”‚   â”œâ”€â”€ validate_manifest.py     # Manifest éªŒè¯
â”‚   â”œâ”€â”€ version_bump.py          # ç‰ˆæœ¬å·å‡çº§
â”‚   â””â”€â”€ quick_start.py           # å¿«é€ŸéªŒè¯
â”‚
â”œâ”€â”€ prefab-manifest.json          # å‡½æ•°å…ƒæ•°æ®ï¼ˆæ ¸å¿ƒï¼‰
â”œâ”€â”€ pyproject.toml               # é¡¹ç›®é…ç½®
â”œâ”€â”€ .editorconfig                # ç¼–è¾‘å™¨é…ç½®
â”œâ”€â”€ .flake8                      # Linter é…ç½®
â”œâ”€â”€ .gitignore                   # Git å¿½ç•¥è§„åˆ™
â”‚
â”œâ”€â”€ README.md                    # ä¸»æ–‡æ¡£
â”œâ”€â”€ QUICK_REFERENCE.md           # å¿«é€Ÿå‚è€ƒ
â”œâ”€â”€ CONTRIBUTING.md              # è´¡çŒ®æŒ‡å—
â”œâ”€â”€ AGENTS.md                    # AI åŠ©æ‰‹æŒ‡å—
â”œâ”€â”€ ARCHITECTURE.md              # æœ¬æ–‡ä»¶ï¼ˆæ¶æ„è®¾è®¡ï¼‰
â”œâ”€â”€ DOCS_INDEX.md                # æ–‡æ¡£å¯¼èˆª
â”œâ”€â”€ CHANGELOG.md                 # æ›´æ–°æ—¥å¿—
â”œâ”€â”€ LICENSE                      # MIT è®¸å¯è¯
â””â”€â”€ prd.md                       # äº§å“éœ€æ±‚æ–‡æ¡£
```

## æ ¸å¿ƒæ–‡ä»¶è¯¦è§£

### 1. `prefab-manifest.json`

**ä½œç”¨**: AI ç†è§£å’Œè°ƒç”¨é¢„åˆ¶ä»¶çš„"API å¥‘çº¦"

**å…³é”®å­—æ®µï¼š**
```json
{
  "schema_version": "1.0",        // æ¸…å•ç‰ˆæœ¬
  "id": "é¢„åˆ¶ä»¶å”¯ä¸€æ ‡è¯†",
  "version": "è¯­ä¹‰åŒ–ç‰ˆæœ¬å·",
  "entry_point": "src/main.py",  // å›ºå®šå…¥å£
  "dependencies_file": "pyproject.toml",
  "functions": [...]              // å‡½æ•°åˆ—è¡¨
}
```

**è®¾è®¡è€ƒè™‘ï¼š**
- å¿…é¡»ä¸ `src/main.py` ä¿æŒä¸¥æ ¼ä¸€è‡´
- ä½¿ç”¨ `scripts/validate_manifest.py` è‡ªåŠ¨éªŒè¯
- ç‰ˆæœ¬å·å¿…é¡»ä¸ Git Tag ä¸€è‡´

### 2. `src/main.py`

**ä½œç”¨**: é¢„åˆ¶ä»¶çš„å”¯ä¸€å…¥å£ç‚¹

**è®¾è®¡è§„èŒƒï¼š**
```python
# âœ… æ­£ç¡®ç¤ºä¾‹
from .utils import helper_function

def exposed_function(param: str) -> dict:
    """å¿…é¡»æœ‰å®Œæ•´çš„æ–‡æ¡£å­—ç¬¦ä¸²"""
    result = helper_function(param)
    return {"success": True, "result": result}

# âŒ é”™è¯¯ç¤ºä¾‹
def _private_function():  # ç§æœ‰å‡½æ•°ä¸åº”å¯¼å‡º
    pass
```

### 3. `pyproject.toml`

**ä½œç”¨**: é¡¹ç›®é…ç½®å’Œä¾èµ–ç®¡ç†

**å…³é”®é…ç½®ï¼š**
```toml
[project]
dependencies = []  # è¿è¡Œæ—¶ä¾èµ–ï¼ˆä¼šè¢«æ‰“åŒ…ï¼‰

[project.optional-dependencies]
dev = [...]  # å¼€å‘ä¾èµ–ï¼ˆä¸ä¼šè¢«æ‰“åŒ…ï¼‰

[tool.hatch.build.targets.wheel]
packages = ["src"]  # æŒ‡å®šè¦æ‰“åŒ…çš„ç›®å½•
```

## CI/CD æµç¨‹

### è§¦å‘æ¡ä»¶
- æ¨é€æ ¼å¼ä¸º `v*.*.*` çš„ Git Tag

### æ‰§è¡Œé˜¶æ®µ

```mermaid
graph TD
    A[æ¨é€ Tag] --> B[æ£€å‡ºä»£ç ]
    B --> C[å®‰è£… uv]
    C --> D[è®¾ç½® Python 3.11]
    D --> E[åŒæ­¥ä¾èµ–]
    
    E --> F[éªŒè¯é˜¶æ®µ]
    F --> F1[Flake8 æ£€æŸ¥]
    F --> F2[Pytest æµ‹è¯•]
    F --> F3[Manifest éªŒè¯]
    F --> F4[ç‰ˆæœ¬å·éªŒè¯]
    
    F1 --> G[æ„å»ºé˜¶æ®µ]
    F2 --> G
    F3 --> G
    F4 --> G
    
    G --> G1[åˆ›å»ºæ„å»ºç›®å½•]
    G1 --> G2[å¤åˆ¶æ ¸å¿ƒæ–‡ä»¶]
    G2 --> G3[ä¸‹è½½è¿è¡Œæ—¶ä¾èµ–]
    
    G3 --> H[æ‰“åŒ…é˜¶æ®µ]
    H --> H1[æ„å»º Wheel åŒ…]
    H1 --> H2[éªŒè¯ Wheel åŒ…]
    
    H2 --> I[å‘å¸ƒé˜¶æ®µ]
    I --> I1[åˆ›å»º GitHub Release]
    I1 --> I2[ä¸Šä¼  .whl æ–‡ä»¶]
    I2 --> J[å®Œæˆ]
```

**v2 ç‰ˆæœ¬å˜æ›´ï¼š**
- æ‰“åŒ…æ ¼å¼ä» `.tar.gz` æ”¹ä¸ºæ ‡å‡† Python Wheel (`.whl`)
- ç‰ˆæœ¬éªŒè¯åŒ…æ‹¬ `pyproject.toml`ã€`prefab-manifest.json` å’Œ Git Tag ä¸‰æ–¹ä¸€è‡´æ€§
- ç±»å‹ç³»ç»Ÿå‡çº§åˆ° v2.2ï¼Œæ”¯æŒ `InputFile` å’Œ `OutputFile`

### éªŒè¯æœºåˆ¶

**ä¸‰é‡éªŒè¯ä¿éšœï¼š**

1. **ä»£ç è´¨é‡**: Flake8 é™æ€æ£€æŸ¥
2. **åŠŸèƒ½æ­£ç¡®æ€§**: Pytest å•å…ƒæµ‹è¯•  
3. **æ¥å£ä¸€è‡´æ€§**: Manifest éªŒè¯è„šæœ¬

ä»»ä½•ä¸€é¡¹å¤±è´¥ï¼Œæ•´ä¸ªæµç¨‹ä¸­æ–­ã€‚

## ä¾èµ–ç®¡ç†ç­–ç•¥

### è¿è¡Œæ—¶ä¾èµ–

```toml
[project]
dependencies = [
    "requests>=2.31.0",  # é”å®šæœ€å°ç‰ˆæœ¬
]
```

**ç‰¹ç‚¹ï¼š**
- ä¼šè¢«æ‰“åŒ…åˆ° `build/vendor/` ç›®å½•
- éšé¢„åˆ¶ä»¶ä¸€èµ·åˆ†å‘
- ä¸ä¾èµ–ç”¨æˆ·ç¯å¢ƒ

### å¼€å‘ä¾èµ–

```toml
[project.optional-dependencies]
dev = [
    "pytest>=7.4.0",
    "flake8>=6.1.0",
]
```

**ç‰¹ç‚¹ï¼š**
- ä»…ç”¨äºå¼€å‘å’Œæµ‹è¯•
- ä¸ä¼šè¢«æ‰“åŒ…
- ä½¿ç”¨ `uv sync --dev` å®‰è£…

## ç‰ˆæœ¬ç®¡ç†

### è¯­ä¹‰åŒ–ç‰ˆæœ¬

éµå¾ª [Semantic Versioning 2.0.0](https://semver.org/):

```
ä¸»ç‰ˆæœ¬.æ¬¡ç‰ˆæœ¬.ä¿®è®¢å·
  |      |      |
  |      |      â””â”€ PATCH: å‘åå…¼å®¹çš„é—®é¢˜ä¿®å¤
  |      â””â”€â”€â”€â”€â”€â”€â”€â”€ MINOR: å‘åå…¼å®¹çš„åŠŸèƒ½æ–°å¢
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MAJOR: ä¸å…¼å®¹çš„ API æ›´æ”¹
```

### è‡ªåŠ¨åŒ–ç‰ˆæœ¬å‡çº§

```bash
# ä½¿ç”¨è„šæœ¬è‡ªåŠ¨æ›´æ–°å¤šä¸ªæ–‡ä»¶
uv run python scripts/version_bump.py patch

# è‡ªåŠ¨æ›´æ–°ï¼š
# - prefab-manifest.json
# - pyproject.toml
```

## æµ‹è¯•ç­–ç•¥

### æµ‹è¯•åˆ†ç±»

1. **å•å…ƒæµ‹è¯•**: æµ‹è¯•å•ä¸ªå‡½æ•°çš„é€»è¾‘
2. **é›†æˆæµ‹è¯•**: æµ‹è¯•å¤šä¸ªæ¨¡å—çš„åä½œ
3. **è¾¹ç•Œæµ‹è¯•**: æµ‹è¯•æç«¯æƒ…å†µå’Œè¾¹ç•Œå€¼

### æµ‹è¯•è¦†ç›–

```bash
# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
uv run pytest tests/ -v --cov=src --cov-report=html

# ç›®æ ‡: ä¿æŒ >80% çš„ä»£ç è¦†ç›–ç‡
```

### æµ‹è¯•ç¤ºä¾‹

```python
class TestMyFunction:
    def test_normal_case(self):
        """æµ‹è¯•æ­£å¸¸æƒ…å†µ"""
        assert my_function("input") == expected
    
    def test_edge_case(self):
        """æµ‹è¯•è¾¹ç•Œæƒ…å†µ"""
        assert my_function("") == {"success": False}
    
    def test_error_handling(self):
        """æµ‹è¯•é”™è¯¯å¤„ç†"""
        with pytest.raises(ValueError):
            my_function(None)
```

## é…ç½®æ–‡ä»¶è¯´æ˜

### `.editorconfig`

ç»Ÿä¸€ä¸åŒç¼–è¾‘å™¨çš„ä»£ç é£æ ¼ï¼š
- ç¼©è¿›æ–¹å¼ï¼ˆç©ºæ ¼/åˆ¶è¡¨ç¬¦ï¼‰
- ç¼©è¿›å¤§å°
- è¡Œå°¾å­—ç¬¦
- æ–‡ä»¶ç¼–ç 

### `.flake8`

Python ä»£ç é£æ ¼æ£€æŸ¥ï¼š
- æœ€å¤§è¡Œé•¿åº¦: 120
- æ’é™¤ç›®å½•: `__pycache__`, `build`, `.venv`
- å¿½ç•¥è§„åˆ™: E203, W503
- æœ€å¤§å¤æ‚åº¦: 10

### `pyproject.toml`

ç°ä»£ Python é¡¹ç›®çš„ç»Ÿä¸€é…ç½®æ–‡ä»¶ï¼š
- é¡¹ç›®å…ƒæ•°æ® (PEP 621)
- æ„å»ºé…ç½® (PEP 517)
- å·¥å…·é…ç½® (pytest, coverage)

## æœ€ä½³å®è·µ

### 1. ä»£ç ç»„ç»‡

```python
# æ¨èçš„æ¨¡å—ç»“æ„
src/
â”œâ”€â”€ main.py           # ä¸»å…¥å£ï¼Œæš´éœ²ç»™ AI çš„å‡½æ•°
â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ validators.py  # éªŒè¯ç›¸å…³
â”‚   â”œâ”€â”€ formatters.py  # æ ¼å¼åŒ–ç›¸å…³
â”‚   â””â”€â”€ helpers.py     # è¾…åŠ©å‡½æ•°
â””â”€â”€ models.py        # æ•°æ®æ¨¡å‹ï¼ˆå¦‚éœ€è¦ï¼‰
```

### 2. é”™è¯¯å¤„ç†

```python
def my_function(input_data: str) -> dict:
    """å§‹ç»ˆè¿”å›ç»“æ„åŒ–çš„å“åº”"""
    try:
        # éªŒè¯è¾“å…¥
        if not input_data:
            return {
                "success": False,
                "error": "è¾“å…¥ä¸èƒ½ä¸ºç©º"
            }
        
        # æ‰§è¡Œé€»è¾‘
        result = process(input_data)
        
        return {
            "success": True,
            "result": result
        }
    except Exception as e:
        return {
            "success": False,
            "error": str(e)
        }
```

### 3. æ–‡æ¡£ç¼–å†™

```python
def function_name(param1: str, param2: int = 0) -> dict:
    """
    ä¸€å¥è¯æè¿°å‡½æ•°çš„ä½œç”¨
    
    è¯¦ç»†è¯´æ˜å‡½æ•°çš„åŠŸèƒ½ã€ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚
    
    Args:
        param1: å‚æ•°1çš„è¯´æ˜ï¼ŒåŒ…æ‹¬ç±»å‹ã€æ ¼å¼ã€èŒƒå›´ç­‰
        param2: å‚æ•°2çš„è¯´æ˜ï¼Œå¯é€‰å‚æ•°è¦è¯´æ˜é»˜è®¤å€¼
    
    Returns:
        è¿”å›å€¼çš„ç»“æ„è¯´æ˜ï¼š
        {
            "success": bool,  # æ˜¯å¦æˆåŠŸ
            "result": any,    # ç»“æœæ•°æ®
            "error": str      # é”™è¯¯ä¿¡æ¯ï¼ˆå¤±è´¥æ—¶ï¼‰
        }
    
    Raises:
        ValueError: ä»€ä¹ˆæƒ…å†µä¸‹ä¼šæŠ›å‡ºæ­¤å¼‚å¸¸
    
    Example:
        >>> result = function_name("test", 10)
        >>> print(result["success"])
        True
    """
    pass
```

## æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„å·¥å…·æ¨¡å—

1. åœ¨ `src/` ä¸‹åˆ›å»ºæ–°æ¨¡å—
2. åœ¨ `src/__init__.py` ä¸­å¯¼å‡ºï¼ˆå¦‚éœ€è¦ï¼‰
3. ç¼–å†™å¯¹åº”çš„æµ‹è¯•æ–‡ä»¶
4. æ›´æ–°æ–‡æ¡£

### æ·»åŠ æ–°çš„éªŒè¯è§„åˆ™

1. ç¼–è¾‘ `scripts/validate_manifest.py`
2. æ·»åŠ æ–°çš„éªŒè¯å‡½æ•°
3. åœ¨ `validate_functions()` ä¸­è°ƒç”¨
4. æ›´æ–°é”™è¯¯æç¤ºä¿¡æ¯

### è‡ªå®šä¹‰ CI/CD æµç¨‹

1. ç¼–è¾‘ `.github/workflows/build-and-release.yml`
2. æ·»åŠ æ–°çš„æ­¥éª¤æˆ–ä½œä¸š
3. æœ¬åœ°æµ‹è¯•ï¼ˆä½¿ç”¨ [act](https://github.com/nektos/act)ï¼‰
4. æ¨é€å¹¶è§‚å¯Ÿ Actions æ—¥å¿—

## å‚è€ƒèµ„æº

### å¤–éƒ¨å‚è€ƒ
- [Obsidian Sample Plugin](https://github.com/obsidianmd/obsidian-sample-plugin) - æœ¬é¡¹ç›®çš„çµæ„Ÿæ¥æº
- [uv Documentation](https://github.com/astral-sh/uv) - uv åŒ…ç®¡ç†å™¨æ–‡æ¡£
- [PEP 621](https://peps.python.org/pep-0621/) - Python é¡¹ç›®å…ƒæ•°æ®æ ‡å‡†
- [Semantic Versioning](https://semver.org/) - è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ

### å†…éƒ¨æ–‡æ¡£
- [README.md](README.md) - ç”¨æˆ·ä½¿ç”¨æŒ‡å—
- [CONTRIBUTING.md](CONTRIBUTING.md) - è´¡çŒ®è€…æŒ‡å—
- [AGENTS.md](AGENTS.md) - AI åŠ©æ‰‹å¼€å‘æŒ‡å—
- [DOCS_INDEX.md](DOCS_INDEX.md) - æ–‡æ¡£å¯¼èˆªç´¢å¼•
- [prd.md](prd.md) - äº§å“éœ€æ±‚æ–‡æ¡£

---

**ç»´æŠ¤è€…**: è¯·åœ¨å¯¹æ¶æ„è¿›è¡Œé‡å¤§æ›´æ”¹æ—¶æ›´æ–°æ­¤æ–‡æ¡£ã€‚

